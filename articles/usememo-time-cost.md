---
title: "useMemoのコストを心配する前に余計なdivを減らせ！"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["react"]
published: true
---

React では、`useMemo`や`React.memo`などが最適化の手段として知られています。

これらは最適化であるため、必要が無いのに`useMemo`を使うことは無駄な最適化であるとして避けられる傾向にあります。

筆者が簡単なベンチマークを取ってみたところ、あるコンポーネントが一つ余計な`useMemo`を持っているよりも、一つ余計な`<div>`をレンダリングする方が、パフォーマンス（レンダリングにかかる時間）をより悪化させることが分かりました。

したがって、`useMemo`などを減らすことに執心する場合は、それと同等以上の熱量で余計な要素を減らすことに執心する必要があります。

ベンチマークはこちらです。

@[codesandbox](https://codesandbox.io/embed/goofy-mahavira-xwdn9?fontsize=14&hidenavigation=1&theme=dark)

結果には当然ばらつきがありますが、筆者の環境では次のような結果が典型的なものとして現れました。

| baseline  | useMemo   | div       |
| --------- | --------- | --------- |
| 586.69 ms | 591.09 ms | 647.80 ms |

数値が大きいほうがレンダリングに時間がかかっていることから、余計な useMemo を含むコンポーネントよりは余計な div を含むコンポーネントのほうがレンダリング時間へのインパクトが大きいことが分かります。

なお、メモ化ということなのでメモリ使用量への影響も気になるところですが、JavaScript コードでのベンチマークではメモリ使用量をうまく測れないので今後の課題となっています。メモリ使用量のデータを提供してくださる方からの情報提供は歓迎されます。尤も、仮想 DOM の仕組みから考えて、余計な div もメモリ使用量の増加に貢献するはずですから、useMemo などが劣る結果にはならないと予想していますが。

## まとめ

余計な`useMemo`の心配をする前に余計な`div`の心配をしてください！
